<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Gestione Portafoglio</title>

    <link rel="stylesheet" href="/static/style.css">

    <style>
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
        }

        .btn-small {
            padding: 6px 12px;
            background: #1976d2;
            color: white;
            border-radius: 6px;
            text-decoration: none;
            font-size: 14px;
        }

        .btn-delete {
            background: #c62828;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;

        }

        .btn-edit {
            background: #f9a825;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            margin-right: 5px;

        }
        .btn-duplicate {
            background: #0288d1;
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            margin-left: 5px;
        }
        .form-box {
            background: #eef3ff;
            padding: 30px;
            border-radius: 12px;
            margin-top: 40px;
            width: 500px;
            margin-left: auto;
            margin-right: auto;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .form-box input {
            margin-bottom: 12px;
            padding: 10px;
            width: 100%;
            font-size: 18px;
            border-radius: 6px;
           border: 1px solid #ccc;
        }

        .form-box h3 {
            font-size: 26px;
            margin-bottom: 20px;
            text-align: center;

        }
        /* Ingrandisce la colonna Azioni */
        table td:last-child {
            text-align: center;
            width: 180px;
        }

    </style>
</head>

<body>

<div class="container">

    <div class="top-bar">
        <h2>‚öôÔ∏è Gestione Portafoglio</h2>

        <a href="/" class="btn-small">‚¨Ö Torna al Portafoglio</a>
    </div>

    <table>
        <tr>
            <th>Nome</th>
            <th>Symbol</th>
            <th>ISIN</th>
            <th>Quantit√†</th>
            <th>Prezzo Carico</th>
            <th>Data Acquisto</th>
            <th>Azioni</th>
        </tr>

        {% for t in titoli %}
        <tr>
            <td>{{ t.nome }}</td>
            <td>{{ t.symbol }}</td>
            <td>{{ t.isin }}</td>
            <td>{{ t.quantita }}</td>
            <td>{{ t.prezzo_carico }}</td>
            <td>{{ t.data_acquisto.strftime("%d/%m/%Y") }}</td>
            <td>
                <button class="btn-edit" onclick="editRow('{{ t.symbol }}')">‚úèÔ∏è</button>
                <button class="btn-delete" onclick="deleteRow('{{ t.symbol }}')">üóëÔ∏è</button>
                <button class="btn-duplicate" onclick="duplicateRow('{{ t.symbol }}')">üìÑ</button>
            </td>
        </tr>
        {% endfor %}
    </table>

    <div class="form-box">
        <h3>‚ûï Aggiungi Nuovo Titolo</h3>

        <form id="addForm">
            <input name="nome" placeholder="Nome"><br>
            <input name="symbol" placeholder="Symbol"><br>
            <input name="quantita" placeholder="Quantit√†" type="number" step="1"><br>
            <input name="prezzo_carico" placeholder="Prezzo Carico" type="number" step="0.0001"><br>
            <input name="data_acquisto" type="date"><br><br>

            <button class="btn-small" type="submit">Aggiungi</button>
        </form>
    </div>

</div>

<script>
document.getElementById("addForm").onsubmit = function(e) {
    e.preventDefault();
    fetch("/gestione_portafoglio/add", {
        method: "POST",
        body: new FormData(this)
    }).then(() => location.reload());
};

function deleteRow(symbol) {
    if (!confirm("Vuoi davvero eliminare questo titolo?")) return;

    let fd = new FormData();
    fd.append("chiave", symbol);

    fetch("/gestione_portafoglio/delete", {
        method: "POST",
        body: fd
    }).then(() => location.reload());
}

function editRow(symbol) {
    alert("Per ora la modifica √® semplice: cancella e reinserisci.\nSe vuoi preparo un popup elegante per la modifica.");
}
function duplicateRow(symbol) {
    let fd = new FormData();
    fd.append("chiave", symbol);

    fetch("/gestione_portafoglio/duplicate", {
        method: "POST",
        body: fd
    }).then(() => location.reload());
}

</script>

</body>
</html>