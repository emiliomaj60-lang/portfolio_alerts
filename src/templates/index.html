<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <title>Portafoglio</title>
    <link rel="stylesheet" href="/static/style.css">

    <style>
        .update-warning {
            text-align: center;
            font-size: 20px;
            color: #c62828;
            margin-bottom: 10px;
            font-weight: bold;
        }

        .last-update {
            text-align: center;
            font-size: 18px;
            color: #555;
            margin-bottom: 25px;
        }

        .refresh-all-btn {
            padding: 14px 26px;
            background: #1e88e5;
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 20px;
            font-weight: bold;
            transition: background 0.2s ease;
        }

        .refresh-all-btn:hover {
            background: #1565c0;
        }

        .refresh-all-btn:active {
            background: #0d47a1;
        }

        .center {
            text-align: center;
            margin-bottom: 25px;
        }
    </style>

    <script>
        function aggiornaTutti() {
            fetch("/aggiorna_tutti")
                .then(r => r.json())
                .then(data => {
                    if (data.status === "ok") {
                        location.reload();
                    }
                });
        }
    </script>
</head>

<body>

<header>
    <h1>PORTAFOGLIO TITOLI</h1>
</header>

<div class="container">

    <!-- üî¥ AVVISO DATI NON AGGIORNATI -->
    <div class="update-warning">
        ‚ö† I dati potrebbero non essere aggiornati ‚Äî premi ‚ÄúAggiorna Tutti‚Äù
    </div>

    <!-- üïí ULTIMO AGGIORNAMENTO -->
    <div class="last-update">
        Ultimo aggiornamento: <b>{{ ultimo_aggiornamento }}</b>
    </div>

    <!-- üîµ BOTTONE AGGIORNA TUTTI -->
    <div class="center">
        <button class="refresh-all-btn" onclick="aggiornaTutti()">üîÑ Aggiorna Tutti</button>
    </div>

    <!-- üîµ TABELLA PORTAFOGLIO -->
    <table>
        <tr>
            <th>Nome</th>
            <th>ISIN</th>
            <th>Simbolo</th>
            <th>Quantit√†</th>
            <th>Prezzo Carico</th>
            <th>Prezzo Attuale</th>
            <th>Gain/Loss</th>
            <th>Dettagli</th>
        </tr>

        {% for t in portafoglio %}
        <tr>
            <td>{{ t.nome }}</td>
            <td>{{ t.isin }}</td>
            <td>{{ t.symbol }}</td>
            <td>{{ t.quantita }}</td>
            <td>{{ t.prezzo_carico }} ‚Ç¨</td>

            <td>
                {% if t.prezzo_attuale %}
                    {{ t.prezzo_attuale }} ‚Ç¨
                {% else %}
                    <span style="color:#999;">n/d</span>
                {% endif %}
            </td>

            <td>
                {% if t.gain_loss is not none %}
                    {% if t.gain_loss >= 0 %}
                        <span class="gain">{{ t.gain_loss|round(2) }}%</span>
                    {% else %}
                        <span class="loss">{{ t.gain_loss|round(2) }}%</span>
                    {% endif %}
                {% else %}
                    <span style="color:#999;">n/d</span>
                {% endif %}
            </td>

            <td>
                <a href="/scheda/{{ t.symbol }}" style="font-size:20px;">üìÑ</a>
            </td>
        </tr>
        {% endfor %}
    </table>

</div>

</body>
</html>